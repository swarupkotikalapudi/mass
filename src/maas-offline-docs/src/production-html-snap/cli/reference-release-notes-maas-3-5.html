<!DOCTYPE html>
<html>
  <head>
    <title>Reference: Release notes MAAS 3.5</title>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" />
    <style>
      .collapsible {
	  cursor: pointer;
	  border: none;
	  outline: none;
	  margin: 0;
	  padding:0;
      }

      .content {
	  display: none;
	  overflow: hidden;
      }

      .collapsible:after {
	  content: '\003E'; /* Unicode right-pointing arrow */
	  float: right;
      }
      .collapsible.active:after {
	  content: 'v'; 
      }
    </style>
    <style>
      #selector a:link{color:black;}
      #selector a:visited{color:black;}
      #selector a:active{color:black;}
      #selector a:hover{color:blue;}
      #sidebar a:link{color:black;}
      #sidebar a:visited{color:black;}
      #sidebar a:active{color:black;}
      #sidebar a:hover{color:blue;}
      #sidebar ul {margin-left:0;margin-top:0;margin-bottom:0;list-style-type:none;padding-left:20px;}
      #sidebar li {margin: 4px 0;}
      #sidebar details {margin-top:0;margin-bottom:0;}
      #sidebar details > summary {
	  padding: 0px;
	  margin-top: 0px;
	  margin-bottom: 0px;
	  width: 200px;
	  background-color: #ffffff;
	  border: none;
	  cursor: pointer;
    	  list-style-type: "< ";
	  direction: rtl;
      }
      #sidebar details[open] > summary {
	  list-style-type: "v ";
      }

      </style>
  </head>
  <body>
    <div id="selector" style="top:0; position:fixed; float:right; background-color:#d9d9d9; width:100%;border-bottom:1px solid black;">
      &nbsp;&nbsp;
      <strong>Offline docs</strong>
      <a href="https://maas.io/docs">(switch to live docs)</a>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      <!-- this is left in just in case we have to update --
	-- older html versions that still use tabs; tbh, we --
	-- should be slowly doing  away with these; other --
	-- changes will be needed, since the older directory --
	-- structures are no longer differentiated, but left --
	-- in place for now so we don't have to dork around --
	-- with the build tools, which expect the subdirs -->
          </div>
    <div id="sidebar" style="float:left; width:25%;margin-top:40px; margin-left:20px">
      <ul>
	<li>
	  <a href="maas-documentation.html"><b>MAAS Documentation</b></a>
	</li>
        <hr style="margin-top: 15px;">
	<li>
 	  <button class="collapsible" id="m01"><a href="tutorials.html">Tutorials&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m02">
	    <ul>
	      <li>
		<a href="tutorial-bootstrapping-maas.html">Bootstrapping MAAS</a>
	      </li>
	      <li>
		<a href="tutorial-try-the-maas-cli.html">Try the MAAS CLI</a>
	      </li>
	      <li>
		<a href="tutorial-creating-custom-images.html">Creating custom images</a>
	      </li>
	      <li>
		<a href="tutorial-get-fancy-cli-output.html">Get fancy CLI output</a>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m03"><a href="how-to-guides.html">How-to guides&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m04">
	    <ul>
	      <li>
		<button class="collapsible" id="m05"><a href="how-to-set-up-maas.html">Set up MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m06">
		  <ul>
		    <li>
		      <a href="how-to-install-maas.html">Install MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-maas.html">Upgrade MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-back-up-maas.html">Back up MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m07"><a href="how-to-manage-maas-networks.html">Manage MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m08">
		  <ul>
		    <li>
		      <a href="how-to-connect-maas-networks.html">Connect MAAS networks</a>
		    </li>
		    <li>
		      <a href="how-to-enable-dhcp.html">Enable DHCP</a>
		    </li>
		    <li>
		      <a href="how-to-use-availability-zones.html">Use availability zones</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m09"><a href="how-to-manage-maas-images.html">Manage MAAS images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m10">
		  <ul>
		    <li>
		      <a href="how-to-use-standard-images.html">Use standard images</a>
		    </li>
		    <li>
		      <a href="how-to-mirror-maas-images.html">Mirror MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-real-time-kernel.html">Deploy a real-time kernel</a>
		    </li>
		    <li>
		      <a href="how-to-use-vmware-images.html">Use VMWare images</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-a-fips-compliant-kernel.html">Deploy a FIPS-compliant kernel</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m12"><a href="how-to-customise-images.html">Customise images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m13">
		  <ul>
		    <li>
		      <a href="how-to-build-maas-images.html">Build MAAS images</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-ubuntu-image.html">Build an Ubuntu image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-7-image.html">Build a RHEL 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-rhel-8-image.html">Build a RHEL 8 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-centos-7-image.html">Build a CentOS 7 image</a>
		    </li>
		    <li>
		      <a href="how-to-build-an-esxi-image.html">Build an ESXi image</a>
		    </li>
		    <li>
		      <a href="how-to-build-a-windows-image.html">Build a Windows image</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m14"><a href="how-to-manage-controllers.html">Manage controllers&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m15">
		  <ul>
		    <li>
		      <a href="how-to-configure-controllers.html">Configure controllers</a>
		    </li>
		    <li>
		      <a href="how-to-enable-high-availability.html">Enable high availability</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m16"><a href="how-to-use-machines.html">Use machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m17">
		  <ul>
		    <li>
		      <a href="how-to-manage-machines.html">Manage machines</a>
		    </li>
		    <li>
		      <a href="how-to-customise-machines.html">Customise machines</a>
		    </li>
		    <li>
		      <a href="how-to-commission-machines-with-maas.html">Commission machines</a>
		    </li>
		    <li>
		      <a href="how-to-allocate-machines-with-maas.html">Allocate machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-machines-with-maas.html">Deploy machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-resource-pools.html">Use resource pools</a>
		    </li>
		    <li>
		      <a href="how-to-set-up-power-drivers.html">Set up power drivers</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m18"><a href="how-to-manage-storage.html">Manage storage&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m19">
		  <ul>
		    <li>
		      <a href="how-to-configure-storage-layouts.html">Configure storage layouts</a>
		    </li>
		    <li>
		      <a href="how-to-manage-block-devices.html">Manage block devices</a>
		    </li>
		    <li>
		      <a href="how-to-manage-partitions.html">Manage partitions</a>
		    </li>
		    <li>
		      <a href="how-to-manage-vmfs-datastores.html">Manage VMFS datastores</a>
		    </li>
		    <li>
		      <a href="how-to-create-custom-storage.html">Create custom storage</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m20"><a href="how-to-use-virtual-machines.html">Use virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m21">
		  <ul>
		    <li>
		      <a href="how-to-set-up-external-lxd.html">Set up external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-external-lxd.html">Use external LXD</a>
		    </li>
		    <li>
		      <a href="how-to-use-lxd-projects.html">Use LXD projects</a>
		    </li>
		    <li>
		      <a href="how-to-manage-virtual-machines.html">Manage virtual machines</a>
		    </li>
		    <li>
		      <a href="how-to-deploy-vms-on-ibm-z.html">Deploy VMs on IBM Z</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m22"><a href="how-to-label-machines.html">Label machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m23">
		  <ul>
		    <li>
		      <a href="how-to-manage-tags.html">Manage
			tags</a>
		    </li>
		    <li>
		      <a href="how-to-annotate-machines.html">Annotate
			machines</a>
		    </li>
		    <li>
		      <a href="how-to-use-machine-tags.html">Use
			machine tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-controller-tags.html">Use
			controller tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-storage-tags.html">Use
			storage tags</a>
		    </li>
		    <li>
		      <a href="how-to-use-network-tags.html">Use
			network tags</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m24"><a href="how-to-use-logging.html">Use logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m25">
		  <ul>
		    <li>
		      <a href="how-to-read-event-logs.html">Read event logs</a>
		    </li>
		    <li>
		      <a href="how-to-review-audit-logs.html">Review audit logs</a>
		    </li>
		    <li>
		      <a href="how-to-read-commissioning-logs.html">Read commissioning logs</a>
		    </li>
		    <li>
		      <a href="how-to-interpret-testing-logs.html">Interpret testing logs</a>
		    </li>
		    <li>
		      <a href="how-to-use-maas-systemd-logs.html">Use MAAS systemd logs</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m26"><a href="how-to-secure-maas.html">Secure MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m27">
		  <ul>
		    <li>
		      <a href="how-to-enhance-maas-security">Enhance MAAS security</a>
		    </li>
		    <li>
		      <a href="how-to-manage-user-access.html">Manage user access</a>
		    </li>
		    <li>
		      <a href="how-to-implement-tls.html">Implement TLS</a>
		    </li>
		    <li>
		      <a href="how-to-integrate-vault.html">Integrate Vault</a>
		    </li>
		    <li>
		      <a href="how-to-configure-an-air-gapped-maas.html">Configure an air-gapped MAAS</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m28"><a href="how-to-change-maas-settings.html">Change MAAS settings&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m29">
		  <ul>
		    <li>
		      <a href="how-to-change-maas-3-4-settings.html">Change MAAS 3.4 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-maas-3-3-settings.html">Change MAAS 3.3 settings</a>
		    </li>
		    <li>
		      <a href="how-to-change-settings-with-the-cli.html">Change settings with the CLI</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m30"><a href="how-to-operate-maas.html">Operate MAAS&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m31">
		  <ul>
		    <li>
		      <a href="how-to-locate-machines.html">Locate machines</a>
		    </li>
		    <li>
		      <a href="how-to-monitor-maas.html">Monitor MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-audit-maas.html">Audit MAAS</a>
		    </li>
		    <li>
		      <a href="how-to-upgrade-postgresql-v12-to-v14.html">Upgrade PostgreSQL v12 to v14</a>
		    </li>
		    <li>
		      <a href="how-to-troubleshoot-common-issues.html">Troubleshoot common issues</a>
		    </li>
		    <li>
		      <a href="how-to-authenticate-to-the-maas-api.html">Authenticate to the MAAS API</a>
		    </li>
		    <li>
		      <a href="how-to-use-the-python-api-client.html">Use the Python API client</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m32"><a href="how-to-join-the-community.html">Join the community&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m33">
		  <ul>
		    <li>
		      <a href="how-to-engage-on-the-discourse-forum.html">Engage on the Discourse forum</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/pro">How to get support</a>
		    </li>
		    <li>
		      <a href="how-to-request-features.html">Request features</a>
		    </li>
		    <li>
		      <a href="how-to-report-and-review-bugs.html">Report and review bugs</a>
		    </li>
		    <li>
		      <a href="how-to-contribute-to-maas-documentation.html">Contribute to MAAS documentation</a>
		    </li>
		    <li>
		      <a href="how-to-contact-us.html">How to contact us</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m34"><a href="reference.html">Reference&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m35">
	    <ul>
	      <li>
		<button class="collapsible" id="m36"><a href="reference-general-information.html">General information&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m37">
		  <ul>
		    <li>
		      <a href="reference-installation-requirements.html">Installation requirements</a>
		    </li>
		    <li>
		      <a href="https://launchpad.net/maas">MAAS source code</a>
		    </li>
		    <li>
		      <a href="reference-documentation-style-guide.html">Documentation style guide</a>
		    </li>
		    <li>
		      <a href="reference-maas-glossary.html">MAAS glossary</a>
		    </li>
		    <li>
		      <a href="https://ubuntu.com/community/code-of-conduct">MAAS community code of conduct</a>
		    </li>
		    <li>
		      <a href="reference-api-documentation.html">MAAS API reference</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m38"><a href="reference-maas-scripts.html">Scripts and automation&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m39">
		  <ul>
		    <li>
		      <a href="reference-commissioning-scripts.html">Commissioning scripts</a>
		    </li>
		    <li>
		      <a href="reference-hardware-test-scripts.html">Hardware test scripts</a>
		    </li>
		    <li>
		      <a href="reference-terraform.html">Terraform IAC</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="reference-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<a href="reference-maas-metrics.html">MAAS metrics</a>
	      </li>
	      <li>
		<a href="reference-power-drivers.html">Power drivers</a>
	      </li>
	      <li>
		<a href="reference-bmc-drivers.html">BMC drivers</a>
	      </li>
	      <li>
		<a href="reference-maas-storage.html">Storage reference</a>
	      </li>
	      <li>
		<button class="collapsible" id="m40"><a href="reference-release-notes.html">Release notes and version details&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m41">
		  <ul>
		    <li>
		      <a href="reference-release-notes-maas-3-4.html">MAAS
			3.4 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-3.html">MAAS
			3.3 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-2.html">MAAS
			3.2 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-1.html">MAAS
			3.1 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-3-0.html">MAAS
			3.0 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-9.html">MAAS
			2.9 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-8.html">MAAS
			2.8 release notes</a>
		    </li>
		    <li>
		      <a href="reference-release-notes-maas-2-7.html">MAAS
			2.7 release notes</a>
		    </li>
		  </ul>
		</div>
	      </li>
	    </ul>
	  </div>
	</li>
	<hr style="margin-top: 15px;">
	<li>
	  <button class="collapsible" id="m42"><a href="explanation.html">Explanation&nbsp;&nbsp;&nbsp;</a></button>
	  <div class="content" id="m43">
	    <ul>
	      <li>
		<a href="about-maas.html">MAAS</a>
	      </li>
	      <li>
		<button class="collapsible" id="m44"><a href="about-machines.html">Machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m45">
		  <ul>
		    <li>
		      <a    href="about-machine-basics.html">Machine
			basics</a>
		    </li>
		    <li>
		      <a href="about-commissioning-machines.html">Commissioning
			machines</a>
		    </li>
		    <li>
		      <a href="about-the-machine-life-cycle.html">The
			machine life-cycle</a>
		    </li>
		    <li>
		      <a href="about-deploying-machines.html">Deploying
			machines</a>
		    </li>
		    <li>
		      <a href="about-machine-customisation.html">Machine
			customisation</a>
		    </li>
		    <li>
		      <a href="about-deploying-running-machines.html">Deploying
			running machines</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m46"><a href="about-virtual-machines.html">Virtual machines&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m47">
		  <ul>
		    <li>
		      <a href="about-lxd.html">LXD</a>
		    </li>
		    <li>
		      <a href="about-lxd-projects.html">LXD projects</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m48"><a href="about-images.html">Images&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m49">
		  <ul>
		    <li>
		      <a href="about-standard-images.html">Standard images</a>
		    </li>
		    <li>
		      <a href="about-custom-images.html">Custom images</a>
		    </li>
		  </ul>
		</div>
	      <li>
		<a href="about-controllers.html">Controllers</a>
	      </li>
	      <li>
		<a href="about-device-labels.html">Device labels</a>
	      </li>
	      <li>
		<button class="collapsible" id="m50"><a href="about-maas-networks.html">MAAS networks&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m51">
		  <ul>
		    <li>
		      <a href="about-the-osi-model.html">The OSI model</a>
		    </li>
		    <li>
		      <a href="about-tcp-ip.html">TCP/IP</a>
		    </li>
		    <li>
		      <a href="about-dhcp-in-maas.html">DHCP in MAAS</a>
		    </li>
		    <li>
		      <a href="about-cloud-networking.html">Cloud networking</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<button class="collapsible" id="m52"><a href="about-monitoring-and-logging.html">Monitoring and logging&nbsp;&nbsp;&nbsp;</a></button>
		<div class="content" id="m53">
		  <ul>
		    <li>
		      <a href="about-maas-performance.html">MAAS performance</a>
		    </li>
		    <li>
		      <a href="about-maas-events.html">MAAS events</a>
		    </li>
		    <li>
		      <a href="about-audit-events.html">Audit events</a>
		    </li>
		    <li>
		      <a href="about-maas-logging.html">MAAS logging</a>
		    </li>
		  </ul>
		</div>
	      </li>
	      <li>
		<a href="about-maas-security.html">Ensuring security in MAAS</a>
	      </li>
	      <li>
	      </li>
	    </ul>
	  </div>
	</li>
      </ul>
    </div>
    <div class="container" style="float:left; width:60%; margin-left: 40px; margin-top:40px; margin-right:30px">
      
      <h1>Reference: Release notes MAAS 3.5</h1>
      <p>MAAS 3.5 delivers substantial improvements in core functionality. We’ve integrated Temporal for enhanced process and thread management, and started a transition to Go, re-implementing some of the rack controller functions as the “MAAS agent.” We’ve standardised logging and monitoring to use tools like syslogd, stepping away from the custom code we had been using. We’ve also expanded the capabilities of existing features to include comprehensive service monitoring and support for deploying ephemeral (RAM-only) OS images. And we’ve made great strides in visibly improving the performance of MAAS.</p>
      <h2 id="capabilities-added-in-maas-3.5">Capabilities added in MAAS 3.5</h2>
      <h3 id="faster-and-more-efficient-image-storage-and-sync">Faster and more efficient image storage and sync</h3>
      <p>MAAS previously stored the boot resources (boot-loaders, kernels and disk images) in the MAAS database, and then replicated them on all Rack controllers. This make operations difficult and slow, as the database quickly became huge and files had to be transferred to all Racks before they were available for use. To address this issue, we have moved the resource storage from the database to the Region controller, and repurposed the storage in the Rack.</p>
      <h4 id="storing-boot-resources-in-the-region-controllers">Storing boot resources in the Region Controllers</h4>
      <p>All boot resources are stored in the local disk in each Controller host (<code>/var/lib/maas/image-storage</code> for <em>deb</em> or <code>$SNAP_COMMON/maas/image-storage</code> for <em>snap</em>). MAAS checks the contents of these directories on every start-up, removing unknown/stale files and downloading any missing resource.</p>
      <p>MAAS checks the amount of disk space available before downloading any resource, and stops synchronising files if there isn’t enough free space. This error will be reported in the logs and a banner in the Web UI.</p>
      <h4 id="storage-use-by-the-rack-controller">Storage use by the Rack Controller</h4>
      <p>Images are no longer copied from the MAAS database to the rack. Instead, the rack downloads images from the region on-demand. This works well with the redesign of the rack controller (now known as the <em>MAAS agent</em>), which has been re-imagined as a 4G LRU caching agent. The MAAS agent has limited storage space, managing cache carefully, but it is possible to configure the size of this cache if you need to do so.</p>
      <p>As boot resources are now downloaded from a Region controller on-demand, a fast and reliable network connection between Regions and Racks is essential for a smooth operation. Adjusting the cache size might also be important for performance if you regularly deploy a large number of different systems.</p>
      <h4 id="one-time-image-migration-process">One-time image migration process</h4>
      <p>The first Region controller that upgrades will try to move all images out of the database. This is a background operation performed after all database migrations are applied, and <strong>it’s not reversible</strong>. This is also a blocking operation, so MAAS might be un-available for some time (i.e., you should plan for some downtime during the upgrade process).</p>
      <p>MAAS will check if the host has enough disk space before starting to export the resources, and it will not proceed otherwise. In order to discover how much disk space you need for all your images, you can run the following SQL query in MAAS database before upgrading:</p>
      <div class="sourceCode" id="cb1"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">select</span> <span class="fu">sum</span>(n.<span class="ot">&quot;size&quot;</span>) <span class="kw">from</span> (<span class="kw">select</span> <span class="kw">distinct</span> <span class="kw">on</span> (f.<span class="ot">&quot;sha256&quot;</span>) f.<span class="ot">&quot;size&quot;</span> <span class="kw">from</span> maasserver_bootresourcefile f <span class="kw">order</span> <span class="kw">by</span> f.<span class="ot">&quot;sha256&quot;</span>) n;</span></code></pre></div>
      <p>The controllers are no longer capable of serving boot resources directly from the database, and won’t be able to commission or to deploy machines until this migration succeeds. If the process fails, you must free enough disk space and restart the controller for the migration to be attempted again.</p>
      <h4 id="sync-works-differently">Sync works differently</h4>
      <p>When downloading boot resources from an upstream source (e.g. images.maas.io), MAAS divides the workload between all Region controllers available, so each file is downloaded only once, but not all by the same controller. After all external files were fetched, the controllers synchronise files among them in a peer-to-peer fashion. This requires <strong>direct communication between Regions to be allowed</strong>, so you should review your firewall rules before upgrading.</p>
      <p>In this new model, a given image is <em>only</em> available for deployment after <em>all</em> regions have it, although stale versions can be used until everyone is up to date. This differs from previous versions where the boot resource needed to be copied to all Rack controllers before it was available, meaning that the images should be ready for use sooner.</p>
      <h3 id="faster-machine-listing-when-deploying-many-machines">Faster machine listing when deploying many machines</h3>
      <p>We have made the MAAS machine listing considerably faster for large page sizes.</p>
      <h3 id="soft-power-off">Soft Power Off</h3>
      <p>MAAS 3.5 allows you to execute a “soft” power-off for one or more machines. Rather than commanding a power-off via the BMC, MAAS will ask the running OS to power-down the machine. This allows machines to go through their normal shutdown routines before powering off.</p>
      <h3 id="improved-select-all-in-the-machine-list">Improved “Select All” in the machine list</h3>
      <p>With MAAS 3.5, you can select only the machines that are visible on the current page.</p>
      <h3 id="improved-support-for-multipath-storage-devices">Improved support for multipath storage devices</h3>
      <p>MAAS support of multipath storage devices has been reviewed and improved, and now it’s capable of correctly identifying the following technologies:</p>
      <ul>
      <li>SCSI</li>
      <li>iSCSI</li>
      <li>Fiber Channel</li>
      <li>SAS (including wide port and expanders)</li>
      </ul>
      <p>When one of these devices is detected by the commissioning scripts, MAAS will suppress the duplicated disks.</p>
      <h3 id="maas-services-exposed-as-prometheus-metrics">MAAS services exposed as Prometheus metrics</h3>
      <p>All services found in the <em>Hardware &gt; Controllers &gt; <controller> &gt; Services</em> panel are now exposed as Prometheus metrics, to include:</p>
      <ul>
      <li>regiond</li>
      <li>bind9</li>
      <li>NTP</li>
      <li>proxy</li>
      <li>syslog</li>
      <li>reverse-proxy</li>
      <li>rackd</li>
      <li>HTTP</li>
      <li>TFTP</li>
      <li>dhcpd(v4)</li>
      <li>dhcpd6</li>
      <li>DNS</li>
      </ul>
      <p>This should improve the user’s ability to monitor MAAS.</p>
      <h4 id="monitoring-setup-sequence-updated">Monitoring setup sequence updated</h4>
      <p>Also, the monitoring setup sequence for MAAS <a href="how-to-monitor-maas.html">has changed</a>.</p>
      <h3 id="logs-collapsed-into-system-log-files">Logs collapsed into system log files</h3>
      <p>With the advent of 3.5, all of the separate logs used by MAAS through version 3.4 have been eliminated and replaced with logging into the standard <code>systemd</code> files. See <a href="how-to-use-maas-systemd-logs.html">How to use MAAS systemd logs</a> in the documentation set for details.</p>
      <h3 id="deployment-of-oracle-linux-8-and-9-on-maas-machines">Deployment of Oracle Linux 8 and 9 on MAAS machines</h3>
      <p>Concurrent with the release of MAAS 3.5, we have added Oracle Linux 8 and Oracle Linux 9 to the stable of custom OS images that can be deployed on MAAS machines.</p>
      <h3 id="ephemeral-os-deployments">Ephemeral OS deployments</h3>
      <p>With the release of MAAS 3.5, ephemeral deployments for Ubuntu and custom images should succeed. Networking is only set up for Ubuntu images. For non-Ubuntu images, you only get the PXE interface set up to do DHCP against MAAS. All other interfaces need to be configured manually after deployment.</p>
      <p>You can choose an ephemeral OS deployment from the deployment configuration screen in the machine list: Just select the “Deploy in memory” option and deploy as normal.</p>
      <h4 id="new-filters-to-support-ephemeral-deployments">New filters to support ephemeral deployments</h4>
      <p>You can now select two new filters for deployment targets: “Deployed in memory” and “Deployed to disk.”</p>
      <h3 id="machine-release-scripts">Machine release scripts</h3>
      <p>MAAS now supports machine release scripts – scripts that will be run when releasing a machine from deployment. These scripts run on an ephemeral copy of Ubuntu that is loaded after the deployed OS has been shut down. This ephemeral Ubuntu is similar to the OS image used to commission machines.</p>
      <p>Release scripts are the same type of scripts that you can create for commissioning or testing, with one difference: <code>script_type: release</code>. Here’s a sample release script:</p>
      <pre class="nohighlight"><code>#!/usr/bin/env python3
      #
      # hello-maas - Simple release script.
      #
      # Copyright (C) 2016-2024 Canonical
      #
      # This program is free software: you can redistribute it and/or modify
      # it under the terms of the GNU Affero General Public License as
      # published by the Free Software Foundation, either version 3 of the
      # License, or (at your option) any later version.
      #
      # This program is distributed in the hope that it will be useful,
      # but WITHOUT ANY WARRANTY; without even the implied warranty of
      # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
      # GNU Affero General Public License for more details.
      #
      # You should have received a copy of the GNU Affero General Public License
      # along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
      #
      # --- Start MAAS 1.0 script metadata ---
      # name: hello-maas
      # title: Simple release script
      # description: Simple release script
      # script_type: release
      # packages:
      #   apt:
      #     - moreutils
      # --- End MAAS 1.0 script metadata --

      import socket

      host = &#39;10.10.10.10&#39;
      port = 3333
      s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
      s.connect((host, port))
      s.sendall(b&#39;Hello, MAAS&#39;)
      s.close()</code></pre>
      <p>You can upload release scripts via API or CLI with a command similar to this one:</p>
      <pre class="nohighlight"><code>maas $PROFILE node-scripts create type=release name=&#39;hello-maas&#39; script@=/home/ubuntu/hello-maas.py</code></pre>
      <p>You can check your uploaded release scripts like this:</p>
      <pre class="nohighlight"><code>maas $PROFILE node-scripts read type=release</code></pre>
      <p>Among listed scripts you might see one named <code>wipe-disks</code>. This is the script that comes with MAAS to support the <em>Disk Erase</em> functionality.</p>
      <p>Once you have your script uploaded to MAAS, you can pass it as a parameter to the MAAS CLI:</p>
      <pre class="nohighlight"><code>maas $PROFILE machine release $SYSTEM_ID scripts=hello-maas</code></pre>
      <p>You can inspect release script results via the MAAS CLI:</p>
      <pre class="nohighlight"><code>maas $PROFILE node-script-results read $SYSTEM_ID type=release</code></pre>
      <h2 id="updates-to-the-maas-ui">Updates to the MAAS UI</h2>
      <ul>
      <li>The header of the “Deploy” form now sticks to the top of the screen when you scroll down</li>
      <li>Added a message on empty tables across the UI</li>
      <li>Moved collapsible forms to side panels</li>
      <li>Improved UI performance by only fetching JavaScript code for pages when it’s needed</li>
      <li>The width of the settings pages is now more consistent</li>
      <li>Improved the grouping of subnets</li>
      <li>Proxied the local documentation so it can be accessed from the UI</li>
      <li>Columns on the machine list will now adapt to the screen size, and hide if there’s not enough space</li>
      <li>Improved the side panel for managing tags – Creating a new tag while applying tags to a machine now expands the side panel with the fields for the new tag – Clicking a tag will expand the side panel to show information on that tag</li>
      <li>Pressing <code>/</code> on your keyboard will now automatically focus the search bar on pages that have one</li>
      <li>If an action fails, the reason for it is now shown in the error message (if applicable)</li>
      <li>Removed the footer from all pages, and moved the links to the status bar at the bottom</li>
      <li>Migrated the maas-ui tooling from “create-react-app” to Vite – Less JavaScript code has to be fetched on the initial page load – Increased performance of the development environment of the UI</li>
      </ul>
      <h3 id="agent-and-temporal-controller-services">“Agent” and “Temporal” controller services</h3>
      <p>MAAS 3.5 makes some internal changes to improve the operation of MAAS, including:</p>
      <ul>
      <li><p>adding a rack agent to assist the rack controller (this agent will eventually replace the rack controller).</p></li>
      <li><p>using a product called Temporal to improve process management and scheduling.</p></li>
      </ul>
      <p>There are no exposed controls, and there is no need for users to take any action on these changes. You will, though, see two new services in *Controllers &gt; <controller> &gt; Services: “agent” and “temporal.”</p>
      <h2 id="ui-bug-fixes">UI bug fixes</h2>
      <ul>
      <li>Images that are queued for download can now be deleted</li>
      <li>Improved alignment of headers in side panels</li>
      <li>Improved header spacing and form layouts across the UI</li>
      <li>Some errors that were appearing as JSON strings are now properly formatted</li>
      <li>Removed a typo on the machine network table’s empty state</li>
      <li>Improved layout of login screen when a login error is shown</li>
      <li>IP range reservation on subnets now shows the correct error messages for start and end IPs</li>
      <li>Improved keyring data placeholder text on the “Change source” form in the Images page</li>
      <li>Image import can now be stopped in the UI</li>
      <li>Fixed label positioning for KVM CPU resources on smaller screens</li>
      <li>On mobile devices, the side navigation will now collapse after a link is tapped</li>
      <li>The “name” column on the partitions table will now re-enable after the “Create volume group” form is closed</li>
      <li>Adding an SSL key no longer shows a “Removed” message</li>
      <li>Adding/editing a user no longer shows a “Deleted” message</li>
      <li>The “Change storage layout” form now has a correct title, and closes after submission</li>
      <li>Adding/editing an API key no longer shows a “Deleted” message</li>
      <li>Composing a VM will now immediately display the new VM in the list</li>
      <li>Reduced padding at the top of the settings pages</li>
      <li>Updating a tag will no longer show an “Error: Not found” screen</li>
      <li>Reduced the font size in the “Delete tag” form</li>
      <li>Improved accessibility in the MAAS intro pages</li>
      <li>The “Filters” dropdown is now disabled if there are no nodes to filter through</li>
      <li>Changed the Network Discovery URL from “dashboard” to “network-discovery”</li>
      <li>Machine status is visible again on machine summary pages</li>
      <li>The “Total VMs” button on a KVM host now links to the list of its VMs</li>
      <li>Clicking the logo in the top corner will now always navigate to the machine list, regardless of user role</li>
      <li>Machines are now sorted by their names in ascending alphabetical order by default</li>
      <li>The “Check power” action can now be accessed from the “Power” dropdown menu</li>
      <li>Confirming image import on the controller list will now close the side panel</li>
      <li>Improved performance of updating multiple settings</li>
      <li>The subnet table now automatically updates after adding a new subnet</li>
      <li>Fixed horizontal scroll bar on the Authentication section of the “Add LXD” form</li>
      <li>Full-screen “Error: the server connection failed” messages should now be much less frequent</li>
      <li>“Allocated” machines can no longer have their storage layout modified</li>
      <li>Fixed a nullable field error in the Windows image settings</li>
      <li>The side panel will now close automatically when navigating to a different page</li>
      <li>Fixed a full screen error message that would sometimes display on machine network and storage tabs</li>
      <li>The secondary side navigation will no longer display on the login screen</li>
      <li>Non-admin usernames are now displayed correctly in the side navigation</li>
      <li>Fixed table pagination in the “Add DHCP snippet” form</li>
      <li>Machine list pagination now displays the correct total number of pages</li>
      <li>Machine list filters are now properly synchronised with the URL</li>
      <li>Made the tool-tip message for “Automatically sync images” a bit more concise</li>
      </ul>
      <h2 id="back-end-bug-fixes">Back-end bug fixes</h2>
      <ul>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2055009">2055009</a><strong>^</strong> : Default zone can not be renamed</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2049508">2049508</a><strong>^</strong> : MAAS has orphan ip addresses and dns records that are slowing down the entire service</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2054377">2054377</a><strong>^</strong> : Temporal worker pool configuration failure</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2053033">2053033</a><strong>^</strong> : Creating MAAS Virsh VM does not work (libvirt: error)</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2052958">2052958</a><strong>^</strong> : PPC64 machines without disk serial fail condense LUNs</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2052503">2052503</a><strong>^</strong> : Additional Power States in Redfish Schema</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2049626">2049626</a><strong>^</strong> : Failed to update NTP configuration</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2044396">2044396</a><strong>^</strong> : allow_dns accepts boolean instead of Int in the help</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2046255">2046255</a><strong>^</strong> : For every interface MAAS is adding an A record for the name <machine>.<domain></li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2045228">2045228</a><strong>^</strong> : DNS updates are consumed concurrently, leading to an incorrect nsupdate payload</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2042645">2042645</a><strong>^</strong> : Power management using ProxMox is broken</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2040188">2040188</a><strong>^</strong> : MAAS config option for IPMI cipher suite ID is not passed to bmc-config script</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2042540">2042540</a><strong>^</strong> : Machine sometimes revert to old status after power control</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2041854">2041854</a><strong>^</strong> : maas config-vault migrate failed due to region not restarting</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2039455">2039455</a><strong>^</strong> : Temporal system status traceback</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2015411">2015411</a><strong>^</strong> : StaticIPAddress matching query does not exist</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/1923315">1923315</a><strong>^</strong> : MaaS API ignores osystem and distro parameters</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/1979058">1979058</a><strong>^</strong> : “space” option still exists as available on Subnet API while being deprecated</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2036759">2036759</a><strong>^</strong> : Adding a custom MAAS sstreams image source without trailing / fails</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2037420">2037420</a><strong>^</strong> : MAAS metadata_url contains a domain name even when DNS resolution is disallowed</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2029417">2029417</a><strong>^</strong> : RPC failure to contact rack/region - operations on closed handler</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/1993916">1993916</a><strong>^</strong> : ThinkSystem SR645 failed commissioning ERROR: Failed to commit `User3:Password’: Invalid/Unsupported Config</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/1999152">1999152</a><strong>^</strong> : websocket API support for stop_mode</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2020397">2020397</a><strong>^</strong> : Custom images which worked ok is not working with 3.2</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2019216">2019216</a><strong>^</strong> : Flaky test- dhcp notify test_sends_notification_over_socket_for_processing</li>
      <li><a href="https://bugs.launchpad.net/maas/+bug/2026283">2026283</a><strong>^</strong> : TestDynamicDNSUpdate.test_as_reverse_record_update flaky test</li>
      </ul>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', (event) => {
	  let coll = document.getElementsByClassName("collapsible");

	  for (let i = 0; i < coll.length; i++) {
	      coll[i].addEventListener("click", function() {
		  toggleCollapsible(this);
	      });
	  }
      });

      function toggleCollapsible(element) {
	  element.classList.toggle("active");
	  let content = element.nextElementSibling;
	  if (content.style.display === "none" || content.style.display === "") {
	      content.style.display = "block";
	  } else {
	      content.style.display = "none";
	  }
      }

      // Assuming you have a way to identify which menu item should be open, e.g., via URL
      function openMenuItemBasedOnPage() {
	  let currentPage = window.location.href; // or however you determine the current page
	  let menuItem;

	  // Logic to determine which menu item corresponds to the current page
	  if (currentPage.includes("page1")) {
	      menuItem = document.getElementById("menu-item-1");
	  } else if (currentPage.includes("page2")) {
	      menuItem = document.getElementById("menu-item-2");
	  }

	  if (menuItem) {
	      toggleCollapsible(menuItem);
	      menuItem.classList.add("active");
	  }
      }

      // Call this function when the page loads
      openMenuItemBasedOnPage();
    </script>
  </body>
</html>
